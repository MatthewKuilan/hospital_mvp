{% extends "clinic/base.html" %}
{% block content %}

    <h2>Provider Calendar View</h2>

    {# --- Filtering Form --- #}
    <form method="get" action="{% url 'provider_calendar' %}">
        <label for="provider">Select Provider:</label>
        <select name="provider" id="provider" required>
            <option value="">-- Select --</option>
            {% for p in providers %}
                <option value="{{ p.id }}" {% if p == selected_provider %}selected{% endif %}>
                    {{ p.name }}
                </option>
            {% endfor %}
        </select>
        
        <label for="date">Select Date:</label>
        <input type="date" name="date" id="date" value="{{ selected_date|date:'Y-m-d' }}" required>
        
        <button type="submit">View Schedule</button>
    </form>

    <hr>

    {# --- Schedule Display --- #}
    {% if selected_provider %}
        <h3>Schedule for {{ selected_provider.name }} on {{ selected_date|date:"l, F j, Y" }}</h3>

        {% if appointments %}
            <table border="1">
                <tr>
                    <th>Time</th>
                    <th>Patient</th>
                    <th>Reason</th>
                    <th>Actions</th>
                </tr>
                {% for a in appointments %}
                <tr>
                    <td>{{ a.start_time|date:"h:i A" }} - {{ a.end_time|date:"h:i A" }}</td>
                    <td>{{ a.patient.last_name }}, {{ a.patient.first_name }} (Chart: {{ a.patient.chart_number }})</td>
                    <td>{{ a.reason }}</td>
                    <td><a href="{% url 'appointment_edit' a.id %}">Edit</a></td>
                </tr>
                {% endfor %}
            </table>
        {% else %}
            <p style="color: green;">{{ selected_provider.name }} has no scheduled appointments on this date and is available.</p>
        {% endif %}

    {% else %}
        <p>Please select a provider and date to view the schedule.</p>
    {% endif %}

{% endblock %}